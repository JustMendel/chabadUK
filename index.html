<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find Your Nearest Chabad Centre</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: #f0f0f0;
            margin: 0;
            color: #333;
        }
        #search-container {
            background: #fff;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 6px 24px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            width: 100%;
            text-align: center;
        }
        h1 {
            font-weight: 600;
            margin-bottom: 20px;
            font-size: 2em;
            color: #2c3e50;
        }
        input[type="text"], input[type="password"], input[type="file"] {
            padding: 15px;
            font-size: 16px;
            width: 100%;
            border: 1px solid #ccc;
            border-radius: 8px;
            margin-bottom: 20px;
            transition: border-color 0.3s;
        }
        input[type="text"]:focus, input[type="password"]:focus, input[type="file"]:focus {
            border-color: #2980b9;
            outline: none;
        }
        button {
            padding: 15px 30px;
            font-size: 16px;
            font-weight: 600;
            color: #fff;
            background-color: #2980b9;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #1f639e;
        }
        #results {
            margin-top: 30px;
            text-align: left;
        }
        #map {
            height: 600px;
            width: 100%;
            max-width: 1000px;
            margin-top: 30px;
            border-radius: 12px;
            box-shadow: 0 6px 24px rgba(0, 0, 0, 0.1);
        }
        .centre {
            margin-bottom: 20px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #fff;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
        }
        .centre strong {
            font-size: 1.2em;
            color: #2980b9;
        }
        a {
            color: #2980b9;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        #admin-container {
            margin-top: 20px;
            text-align: center;
        }
        #admin-form {
            display: none;
            margin-top: 20px;
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 6px 24px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            width: 100%;
        }
        #admin-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        #admin-tabs button {
            margin: 0 10px;
        }
        #add-centre-section, #edit-delete-section {
            display: none;
        }
        .admin-centre {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid #ccc;
        }
        .admin-centre button {
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div id="search-container">
        <h1>Find Your Nearest Chabad Centre</h1>
        <input type="text" id="location-input" placeholder="Enter a valid UK postcode.">
        <button onclick="findChabadCentres()">Find My Nearest Chabad Centre</button>
        <div id="results"></div>
    </div>
    <div id="map"></div>

    <div id="admin-container">
        <button onclick="showAdminPopup()">Admin Login</button>
    </div>

    <div id="admin-popup" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); background:#fff; padding:30px; border-radius:12px; box-shadow:0 6px 24px rgba(0, 0, 0, 0.2); z-index:1000;">
        <h2>Admin Login</h2>
        <input type="password" id="admin-password" placeholder="Enter password">
        <button onclick="checkPassword()">Submit</button>
        <button onclick="closeAdminPopup()">Cancel</button>
    </div>

    <div id="admin-form" style="display:none;">
        <h2>Admin Panel</h2>
        <div id="admin-tabs">
            <button onclick="showAddCentreSection()">Add New Listing</button>
            <button onclick="showEditDeleteSection()">Edit/Delete Listings</button>
        </div>
        <div id="add-centre-section">
            <h3>Add Chabad Centre</h3>
            <input type="text" id="centre-name" placeholder="Centre Name">
            <input type="text" id="rabbi-name" placeholder="Rabbi Name">
            <input type="text" id="phone" placeholder="Phone">
            <input type="text" id="email" placeholder="Email">
            <input type="text" id="address" placeholder="Address">
            <input type="text" id="postcode" placeholder="Postcode">
            <input type="text" id="website" placeholder="Website">
            <button onclick="addOrModifyCentre()">Save Centre</button>
            <input type="file" id="upload-json" accept=".json, .csv" onchange="uploadCentres(event)">
            <button onclick="addUploadedCentres()">Add Uploaded Centres</button>
        </div>
        <div id="edit-delete-section">
            <h3>Edit/Delete Chabad Centres</h3>
            <div id="centres-list"></div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        let chabadCentres = [
  {
    "centre": "Battersea",
    "rabbi": "Rabbi Adler",
    "phone": "07710 524 460",
    "email": "rabbi@jewishbattersea.com",
    "address": "Battersea, London",
    "postcode": "SW11",
    "coordinates": { "lat": 51.4647, "lng": -0.1676 }
  },
  {
    "centre": "Belgravia",
    "rabbi": "Rabbi Mendel Kalmenson",
    "phone": "0207 745 6529",
    "email": "events@chabadbelgravia.com",
    "address": "11 Grosvenor Place, London",
    "postcode": "SW1X 7HH",
    "coordinates": { "lat": 51.5005, "lng": -0.1505 }
  },
  {
    "centre": "Bloomsbury",
    "rabbi": "Rabbi Yisroel Lew",
    "phone": "0207 060 9770",
    "email": "info@bloomsburychabad.org",
    "address": "Bloomsbury, London",
    "postcode": "WC1B",
    "coordinates": { "lat": 51.5211, "lng": -0.1281 }
  },
  {
    "centre": "Borehamwood & Elstree",
    "rabbi": "Rabbi Chaim Hoch",
    "phone": "0209 049 8090",
    "email": "rabbi@jewishlifecentre.org",
    "address": "Borehamwood, Hertfordshire",
    "postcode": "WD6",
    "coordinates": { "lat": 51.6542, "lng": -0.2786 }
  },
  {
    "centre": "Bricket Wood",
    "rabbi": "Rabbi Eliezer Tunk",
    "phone": "0208 638 7178",
    "email": "rabbi@jewishbricketwood.org",
    "address": "Bricket Wood, Hertfordshire",
    "postcode": "AL2",
    "coordinates": { "lat": 51.7121, "lng": -0.3698 }
  },
  {
    "centre": "Buckhurst Hill",
    "rabbi": "Rabbi Odom Brandman",
    "phone": "0208 926 2376",
    "email": "rabbibrandman@chabadonthehill.co.uk",
    "address": "107 Epping New Road, Buckhurst Hill, Essex",
    "postcode": "IG9 5TQ",
    "coordinates": { "lat": 51.6231, "lng": 0.0408 }
  },
  {
    "centre": "Bushey",
    "rabbi": "Rabbi Yosef Sharfstein",
    "phone": "07501 294 873",
    "email": "rabbi@busheychabad.org",
    "address": "5 Hekomer Road, Bushey, Hertfordshire",
    "postcode": "WD23 3NL",
    "coordinates": { "lat": 51.6443, "lng": -0.3628 }
  },
  {
    "centre": "Catford & Bromley",
    "rabbi": "Rabbi Mendy Brackman",
    "phone": "07958 176 628",
    "email": "chabadselondon@gmail.com",
    "address": "4 Rangfield Road, Bromley, Kent",
    "postcode": "BR1 4RZ",
    "coordinates": { "lat": 51.406, "lng": 0.0143 }
  },
  {
    "centre": "Crouch End & West Haringey",
    "rabbi": "Rabbi Boruch Altein",
    "phone": "07496 123 342",
    "email": "info@crouchendchabad.org",
    "address": "51 Ferme Park Road, Crouch End, London",
    "postcode": "N4 4EB",
    "coordinates": { "lat": 51.5763, "lng": -0.1153 }
  },
  {
    "centre": "Ealing & West London",
    "rabbi": "Rabbi Hershi Vogel",
    "phone": "020 3620 9873",
    "email": "hvoge@aol.com",
    "address": "27 Ainsdale Road, Ealing, London",
    "postcode": "W5 1JY",
    "coordinates": { "lat": 51.5162, "lng": -0.3011 }
  },
  {
    "centre": "Edgware",
    "rabbi": "Rabbi Leivi Sudak",
    "phone": "0208 905 4141",
    "email": "rabbi@loe.org.uk",
    "address": "203 Hale Lane, Edgware, Middlesex",
    "postcode": "HA8 9PZ",
    "coordinates": { "lat": 51.6132, "lng": -0.2761 }
  },
  {
    "centre": "Edgware (additional)",
    "rabbi": "Rabbi Zalman Sudak",
    "phone": "07977 094 999",
    "email": "zalmansudak@lubavitchofedgware.com",
    "address": "191 Hale Lane, Edgware, Middlesex",
    "postcode": "HA8 9QN",
    "coordinates": { "lat": 51.6122, "lng": -0.2759 }
  },
  {
    "centre": "Epping",
    "rabbi": "Rabbi Yossi Posen",
    "phone": "07496 504 345",
    "email": "rabbiposen@chabadepping.co.uk",
    "address": "12 Bridge Hill, Epping, Essex",
    "postcode": "CM16 4ER",
    "coordinates": { "lat": 51.6989, "lng": 0.1084 }
  },
  {
    "centre": "Finchley",
    "rabbi": "Rabbi Mechel (Mechy) Gancz",
    "phone": "0203 719 2231",
    "email": "info@chabadfinchley.com",
    "address": "4 Woodberry Grove, London",
    "postcode": "N12 0DR",
    "coordinates": { "lat": 51.6081, "lng": -0.1756 }
  },
  {
    "centre": "Golders Green",
    "rabbi": "Rabbi Yossi Simon",
    "phone": "07966 492 816",
    "email": "rabbi@tzivoshashem.co.uk",
    "address": "156 Golders Green Road, London",
    "postcode": "NW11 8HE",
    "coordinates": { "lat": 51.5745, "lng": -0.2005 }
  },
  {
    "centre": "Chabad Israeli Centre",
    "rabbi": "Rabbi Shneor Glitzenstein",
    "phone": "07925 857 050",
    "email": "israelondon@gmail.com",
    "address": "1035 Finchley Road, London",
    "postcode": "NW11 7ES",
    "coordinates": { "lat": 51.5719, "lng": -0.1912 }
  },
  {
    "centre": "Greenwich",
    "rabbi": "Rabbi Ephraim Carlebach",
    "phone": "07460 619 382",
    "email": "rabbi@jewishdockands.com",
    "address": "115 Trafalgar Road, Greenwich, London",
    "postcode": "SE10 9TX",
    "coordinates": { "lat": 51.4823, "lng": 0.0014 }
  },
  {
    "centre": "Hampstead",
    "rabbi": "Rabbi Yisroel Weisz",
    "phone": "07976 522 807",
    "email": "shulinhampstead@gmail.com",
    "address": "Hampstead, London",
    "postcode": "NW3",
    "coordinates": { "lat": 51.556, "lng": -0.1756 }
  },
  {
    "centre": "Hampstead Garden Suburb",
    "rabbi": "Rabbi Bentzi Sudak",
    "phone": "020 7078 7469",
    "email": "bsudak@chabad.org.uk",
    "address": "41 Market Place, London",
    "postcode": "NW11 6JT",
    "coordinates": { "lat": 51.5807, "lng": -0.1962 }
  },
  {
    "centre": "Hammersmith & Chiswick",
    "rabbi": "Rabbi Osher Krichevsky",
    "phone": "07506 319 770",
    "email": "jewishhammersmith@gmail.com",
    "address": "Hammersmith, London",
    "postcode": "W6",
    "coordinates": { "lat": 51.492, "lng": -0.2296 }
  },
  {
    "centre": "Hendon",
    "rabbi": "Rabbi Gershon Overlander",
    "phone": "0208 202 1600",
    "email": "rabbigo@gmail.com",
    "address": "112-114 Brent Street, London",
    "postcode": "NW4 2DT",
    "coordinates": { "lat": 51.5854, "lng": -0.2244 }
  },
  {
    "centre": "Ilford - NE London & Essex",
    "rabbi": "Rabbi Aryeh Sufrin MBE",
    "phone": "0208 554 1624",
    "email": "rabbisufrin@chabadilford.co.uk",
    "address": "397 Eastern Avenue, Gants Hill, Essex",
    "postcode": "IG2 6LR",
    "coordinates": { "lat": 51.5769, "lng": 0.0618 }
  },
  {
    "centre": "Islington",
    "rabbi": "Rabbi Mendy Korer",
    "phone": "0207 700 6974",
    "email": "rabbi@jewishislington.co.uk",
    "address": "36 Upper Street, London",
    "postcode": "N1 0PN",
    "coordinates": { "lat": 51.5351, "lng": -0.1036 }
  },
  {
    "centre": "Kentish Town",
    "rabbi": "Rabbi Yossi Baitz",
    "phone": "07947 600 599",
    "email": "contact@jewishkentishtown.co.uk",
    "address": "Kentish Town, London",
    "postcode": "NW5",
    "coordinates": { "lat": 51.5517, "lng": -0.1401 }
  },
  {
    "centre": "Maida Vale (Chabad Francophone)",
    "rabbi": "Rabbi Yossef Naparstek",
    "phone": "07986 607 052",
    "email": "yossefnaparstek@gmail.com",
    "address": "Maida Vale, London",
    "postcode": "W9",
    "coordinates": { "lat": 51.5266, "lng": -0.1853 }
  },
  {
    "centre": "Mill Hill East",
    "rabbi": "Rabbi Dovie Schochet",
    "phone": "07397 954 066",
    "email": "mhechabad@gmail.com",
    "address": "Mill Hill East, London",
    "postcode": "NW7",
    "coordinates": { "lat": 51.6141, "lng": -0.2095 }
  },
  {
    "centre": "Notting Hill",
    "rabbi": "Rabbi Shneur Wineberg",
    "phone": "07456 286 538",
    "email": "rabbi@jewishnottinghill.co.uk",
    "address": "12 Gloucester Mews West, London",
    "postcode": "W2 6DY",
    "coordinates": { "lat": 51.5177, "lng": -0.1892 }
  },
  {
    "centre": "Pinner",
    "rabbi": "Rabbi Shaya Green",
    "phone": "07791 155 447",
    "email": "rabbi@chabadpinner.com",
    "address": "Pinner, London",
    "postcode": "HA5",
    "coordinates": { "lat": 51.5925, "lng": -0.3803 }
  },
  {
    "centre": "Radlett",
    "rabbi": "Rabbi Alexander Dubrawsky",
    "phone": "01923 855 083",
    "email": "radlett@lubavitchuk.com",
    "address": "122 Watling Street, Radlett, Hertfordshire",
    "postcode": "WD7 7AF",
    "coordinates": { "lat": 51.6835, "lng": -0.3173 }
  },
  {
    "centre": "Shoreditch/East End",
    "address": "Shoreditch, London",
    "postcode": "E1",
    "coordinates": { "lat": 51.5247, "lng": -0.0737 }
  },
  {
    "centre": "South East London - Bromley",
    "rabbi": "Rabbi Menachem Brackman",
    "phone": "07958 176 628",
    "email": "",
    "address": "52 Broadfield Road, Bromley, London",
    "postcode": "BR1 4RQ",
    "coordinates": { "lat": 51.409, "lng": 0.0174 }
  },
  {
    "centre": "South Bank",
    "rabbi": "Rabbi Moshe Adler",
    "phone": "07710 524 460",
    "email": "madler53@gmail.com",
    "wife": "Gitty",
    "address": "South Bank, London",
    "postcode": "SE1",
    "coordinates": { "lat": 51.5054, "lng": -0.0904 }
  },
  {
    "centre": "South London",
    "rabbi": "Rabbi Dovid Cohen",
    "phone": "07801 491 386",
    "email": "dovid@chabadslc.com",
    "address": "1 Leopold Avenue, London",
    "postcode": "SW19 7ET",
    "coordinates": { "lat": 51.4284, "lng": -0.2055 }
  },
  {
    "centre": "Southgate",
    "rabbi": "Rabbi Herschel Kesselman",
    "phone": "020 8361 3044",
    "email": "k4torah@aol.con",
    "address": "33 Osidge Lane, Southgate, London",
    "postcode": "N14 5JL",
    "coordinates": { "lat": 51.6336, "lng": -0.1318 }
  },
  {
    "centre": "St Johns Wood",
    "rabbi": "Rabbi Mendel Cohen",
    "phone": "07772 612 661",
    "email": "mendelcohen@gmail.com",
    "address": "St Johns Wood, London",
    "postcode": "NW8",
    "coordinates": { "lat": 51.5341, "lng": -0.1712 }
  },
  {
    "centre": "West Hampstead",
    "rabbi": "Rabbi Dovid Katz",
    "phone": "0207 624 2770",
    "email": "info@chabadnw6.com",
    "address": "West Hampstead, London",
    "postcode": "NW6",
    "coordinates": { "lat": 51.546, "lng": -0.1913 }
  },
  {
    "centre": "Wimbledon",
    "rabbi": "Rabbi Nissan Dovid Dubov",
    "phone": "0208 255 7770",
    "email": "info@chabadwimbledon.com",
    "address": "42 St Georges Road, Wimbledon, London",
    "postcode": "SW19 4ED",
    "coordinates": { "lat": 51.4253, "lng": -0.213 }
  },
  {
    "centre": "Beis Chana (Jewish Women's Centre)",
    "phone": "0208 809 6508",
    "email": "beischana@lubavitchuk.com",
    "address": "Beis Chana, London",
    "postcode": "N16 5EP",
    "coordinates": { "lat": 51.5701, "lng": -0.0744 }
  },
  {
    "centre": "Bournemouth",
    "rabbi": "Rabbi Yossie Alperowitz",
    "phone": "01202 555 367",
    "email": "bmthchabad@gmail.com",
    "address": "20 Lansdowne Road, Bournemouth",
    "postcode": "BH1 1SD",
    "coordinates": { "lat": 50.724, "lng": -1.8633 }
  },
  {
    "centre": "Bowden",
    "rabbi": "Rabbi Dovid Jaffe",
    "address": "Bowden",
    "postcode": "WA14",
    "coordinates": { "lat": 53.376, "lng": -2.347 }
  },
  {
    "centre": "Brighton",
    "rabbi": "Rabbi Pesach Efune",
    "phone": "01273 321 919",
    "email": "rabbiefune@hotmail.com",
    "address": "15 The Upper Drive, Hove",
    "postcode": "BN3 6GR",
    "coordinates": { "lat": 50.8357, "lng": -0.1746 }
  },
  {
    "centre": "Brighton Campus",
    "phone": "01273 693 151",
    "address": "14 Richmond Terrace, Brighton",
    "postcode": "BN2 9SA",
    "coordinates": { "lat": 50.8251, "lng": -0.1344 }
  },
  {
    "centre": "Bristol",
    "rabbi": "Rabbi Mendy Singer",
    "phone": "07958 169 159",
    "email": "rabbimendy@jewishbristol.com",
    "address": "Flat 2, 20 Belgrave Road, Bristol",
    "postcode": "BS8 2AB",
    "coordinates": { "lat": 51.4548, "lng": -2.615 }
  },
  {
    "centre": "Bristol Campus",
    "rabbi": "Rabbi Dovid Usiskin",
    "phone": "0117 909 9641",
    "email": "bristolchabad@gmail.com",
    "wife": "Leah",
    "address": "",
    "postcode": "BS8",
    "coordinates": { "lat": 51.4548, "lng": -2.615 }
  },
  {
    "centre": "Cambridge",
    "rabbi": "Rabbi Reuven Leigh",
    "phone": "01223 354 603",
    "email": "rabbi@cuchabad.org",
    "address": "37A Castle Street, Cambridge",
    "postcode": "CB3 0AH",
    "coordinates": { "lat": 52.2112, "lng": 0.1127 }
  },
  {
    "centre": "Cardiff",
    "rabbi": "Rabbi Michoel Rose",
    "phone": "07928 669 536",
    "email": "michoelrose@gmail.com",
    "wife": "Blima",
    "address": "",
    "postcode": "CF10",
    "coordinates": { "lat": 51.4816, "lng": -3.1791 }
  },
  {
    "centre": "Cheadle",
    "rabbi": "Rabbi Peretz Chein",
    "phone": "0161 428 1818",
    "email": "rabbi@chainetwork.com",
    "address": "3 Milton Crescent, Cheadle",
    "postcode": "SK8 1NT",
    "coordinates": { "lat": 53.3897, "lng": -2.2175 }
  },
  {
    "centre": "Fallowfield",
    "rabbi": "Rabbi Zalmy Loewenthal",
    "wife": "Mushky",
    "address": "Fallowfield, Manchester",
    "postcode": "M14",
    "coordinates": { "lat": 53.4463, "lng": -2.2216 }
  },
  {
    "centre": "Leeds",
    "rabbi": "Rabbi Yeremiyahu Angyalfi",
    "phone": "0113 266 3311",
    "email": "yangyalfi@judaismlive.com",
    "address": "168 Shadwell Lane, Leeds",
    "postcode": "LS17 8AD",
    "coordinates": { "lat": 53.8437, "lng": -1.5077 }
  },
  {
    "centre": "Leeds Campus",
    "rabbi": "Rabbi Michoel Danow",
    "phone": "0113 242 4127",
    "email": "mdanow@gmail.com",
    "address": "81 Clarendon Road, Leeds",
    "postcode": "LS2 9PJ",
    "coordinates": { "lat": 53.8026, "lng": -1.5562 }
  },
  {
    "centre": "Leicester",
    "rabbi": "Rabbi Shmuel Pink",
    "phone": "0116 270 6622",
    "email": "rabbipink@btinternet.com",
    "address": "16 Stanley Road, Leicester",
    "postcode": "LE2 1RE",
    "coordinates": { "lat": 52.6143, "lng": -1.119 }
  },
  {
    "centre": "Liverpool",
    "rabbi": "Rabbi Avrohom Kievman",
    "phone": "0151 729 0443",
    "email": "info@lubavitchliverpool.com",
    "address": "76 Beech Lane, Liverpool",
    "postcode": "L18 3ER",
    "coordinates": { "lat": 53.383, "lng": -2.9047 }
  },
  {
    "centre": "Liverpool Campus",
    "rabbi": "Rabbi Shmuli Brown",
    "phone": "0151 727 7710",
    "email": "rabbi@ulivchabad.org",
    "address": "29a Aigburth Road, Liverpool",
    "postcode": "L17 4JH",
    "coordinates": { "lat": 53.3839, "lng": -2.9496 }
  },
  {
    "centre": "Luton",
    "rabbi": "Rabbi Yossi Schwei",
    "phone": "07825 372 469",
    "email": "yschwei@gmail.com",
    "address": "Luton",
    "postcode": "LU1",
    "coordinates": { "lat": 51.8787, "lng": -0.4206 }
  },
  {
    "centre": "Manchester",
    "rabbi": "Rabbi Yisroel Cohen",
    "phone": "0161 792 6335",
    "email": "rabbi@lchaim.org.uk",
    "address": "62 Singleton Road, Manchester",
    "postcode": "M7 4LU",
    "coordinates": { "lat": 53.503, "lng": -2.275 }
  },
  {
    "centre": "Manchester - Prestwich",
    "rabbi": "Rabbi Levi Cohen",
    "phone": "0161 536 5719",
    "email": "info@chabadprestwich.org.uk",
    "address": "Prestwich, Manchester",
    "postcode": "M25",
    "coordinates": { "lat": 53.531, "lng": -2.28 }
  },
  {
    "centre": "Manchester - Trafford",
    "rabbi": "Rabbi Mendel Chein",
    "phone": "07935 895 600",
    "email": "cheinmendel@gmail.com",
    "address": "Trafford, Manchester",
    "postcode": "M32",
    "coordinates": { "lat": 53.462, "lng": -2.309 }
  },
  {
    "centre": "Manchester - Whitefield",
    "rabbi": "Rabbi Shmuli Jaffe",
    "phone": "0161 766 1818",
    "email": "rabbishmulijaffe@gmail.com",
    "address": "146 Park Lane, Whitefield, Manchester",
    "postcode": "M45 7PX",
    "coordinates": { "lat": 53.5433, "lng": -2.2869 }
  },
  {
    "centre": "Manchester Campus",
    "rabbi": "Rabbi Eli Simon",
    "phone": "0161 224 4326",
    "email": "rabbi@muchabad.org",
    "address": "3 Waller Avenue, Manchester",
    "postcode": "M14 6EB",
    "coordinates": { "lat": 53.4543, "lng": -2.2264 }
  },
  {
    "centre": "Milton Keynes",
    "rabbi": "Rabbi Yitzchok Lew",
    "phone": "07400 922 860",
    "email": "yitzchaklew@gmail.com",
    "address": "Milton Keynes",
    "postcode": "MK9",
    "coordinates": { "lat": 52.0406, "lng": -0.7606 }
  },
  {
    "centre": "Newcastle",
    "rabbi": "Rabbi Aaron Lipsey",
    "phone": "07793 746 454",
    "email": "amlipsey@gmail.com",
    "address": "Newcastle",
    "postcode": "NE1",
    "coordinates": { "lat": 54.9784, "lng": -1.6174 }
  },
  {
    "centre": "Nottingham",
    "rabbi": "Rabbi Mendy Lent",
    "phone": "0115 783 6985",
    "email": "info@nottschabad.org",
    "address": "3 Gregory Street, Nottingham",
    "postcode": "NG7 2LR",
    "coordinates": { "lat": 52.943, "lng": -1.181 }
  },
  {
    "centre": "Oxford",
    "rabbi": "Rabbi Eli Brackman",
    "phone": "01865 200 158",
    "email": "info@oxfordchabad.org",
    "address": "61 George Street, Oxford",
    "postcode": "OX1 2BQ",
    "coordinates": { "lat": 51.7541, "lng": -1.2649 }
  },
  {
    "centre": "Sheffield",
    "rabbi": "Rabbi Yoinoson Golomb",
    "phone": "0114 258 3507",
    "email": "rabbigolomb@blueyonder.co.uk",
    "address": "81 Lyndhurst Road, Sheffield",
    "postcode": "S11 9BJ",
    "coordinates": { "lat": 53.3636, "lng": -1.4984 }
  },
  {
    "centre": "Solihull",
    "rabbi": "Rabbi Yehuda Pink",
    "phone": "0121 706 8736",
    "email": "ypink@lubavitchuk.com",
    "address": "7 Granby Close, Solihull",
    "postcode": "B92 7DP",
    "coordinates": { "lat": 52.432, "lng": -1.7751 }
  },
  {
    "centre": "Southend",
    "rabbi": "Rabbi Tzvi Birnhack",
    "phone": "07534 648 061",
    "email": "rabbibirnhack@chabadsouthend.co.uk",
    "address": "Southend, UK",
    "postcode": "SS1",
    "coordinates": { "lat": 51.5378, "lng": 0.7146 }
  },
  {
    "centre": "Sussex",
    "rabbi": "Rabbi Zalman Lewis",
    "phone": "01273 693 151",
    "email": "zalman@chabadsussex.org",
    "address": "Sussex, UK",
    "postcode": "BN1",
    "coordinates": { "lat": 50.848, "lng": -0.1406 }
  },
  {
    "centre": "Watford",
    "rabbi": "Rabbi Ephraim Levine",
    "phone": "07909 513 025",
    "email": "ephraimlevine@gmail.com",
    "address": "Watford, UK",
    "postcode": "WD17",
    "coordinates": { "lat": 51.6565, "lng": -0.3903 }
  },
  {
    "centre": "Belfast",
    "rabbi": "Rabbi Mendy Brackman",
    "address": "Belfast",
    "postcode": "BT1",
    "coordinates": { "lat": 54.5973, "lng": -5.9301 }
  },
  {
    "centre": "Edinburgh",
    "rabbi": "Rabbi Pinny Weinman",
    "phone": "0131 201 2010",
    "email": "rabbi@chabadofedinburgh.com",
    "wife": "Gitty",
    "address": "9 Cobden Crescent, Edinburgh",
    "postcode": "EH9 2BG",
    "coordinates": { "lat": 55.9306, "lng": -3.1827 }
  },
  {
    "centre": "Glasgow",
    "rabbi": "Rabbi Chaim Jacobs",
    "phone": "0141 638 6116",
    "email": "lubofscot@aol.com",
    "wife": "Sora",
    "address": "8 Orchard Drive, Giffnock, Glasgow",
    "postcode": "G46 7NR",
    "coordinates": { "lat": 55.7995, "lng": -4.2906 }
  },
  {
    "centre": "Dublin",
    "rabbi": "Rabbi Zalman Lent",
    "phone": "00353 1406 4818",
    "email": "zalman.lent@gmail.com",
    "wife": "Rifky",
    "address": "34 Rathfarnham Road, Terenure, Dublin",
    "postcode": "D6W",
    "coordinates": { "lat": 53.3093, "lng": -6.2959 }
  }
];
;

        const map = L.map('map').setView([51.509865, -0.118092], 6);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        function addMarkers() {
            map.eachLayer(layer => {
                if (layer instanceof L.Marker) {
                    map.removeLayer(layer);
                }
            });
            chabadCentres.forEach(centre => {
                if (centre.coordinates) {
                    L.marker([centre.coordinates.lat, centre.coordinates.lng]).addTo(map)
                        .bindPopup(`<strong>${centre.centre}</strong><br>${centre.address}<br><a href="mailto:${centre.email}">${centre.email}</a><br>${centre.phone}<br><a href="${centre.website}" target="_blank">${centre.website}</a>`);
                }
            });
        }

        addMarkers();

        function findChabadCentres() {
            const userInput = document.getElementById('location-input').value;
            if (!userInput) {
                alert('Please enter a location to search.');
                return;
            }

            fetch(`https://api.postcodes.io/postcodes/${encodeURIComponent(userInput)}`)
                .then(response => response.json())
                .then(data => {
                    if (data.status !== 200 || !data.result) {
                        alert('Invalid postcode or location. Please try again.');
                        return;
                    }

                    const userCoordinates = {
                        lat: data.result.latitude,
                        lng: data.result.longitude
                    };

                    const sortedCentres = chabadCentres.map(centre => {
                        const distance = getDistance(userCoordinates, centre.coordinates);
                        return { ...centre, distance };
                    }).sort((a, b) => a.distance - b.distance);

                    displayResults(sortedCentres.slice(0, 5));
                })
                .catch(error => {
                    console.error('Error fetching location data:', error);
                    alert('There was an error finding your location. Please try again.');
                });
        }

        function getDistance(coords1, coords2) {
            const R = 6371; // Radius of the earth in km
            const dLat = deg2rad(coords2.lat - coords1.lat);
            const dLon = deg2rad(coords2.lng - coords1.lng);
            const a = 
                Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(deg2rad(coords1.lat)) * Math.cos(deg2rad(coords2.lat)) *
                Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c; // Distance in km
        }

        function deg2rad(deg) {
            return deg * (Math.PI / 180);
        }

        function displayResults(centres) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';
            centres.forEach(centre => {
                const centreDiv = document.createElement('div');
                centreDiv.className = 'centre';
                centreDiv.innerHTML = `
                    <strong>${centre.centre}</strong><br>
                    ${centre.address}<br>
                    <a href="mailto:${centre.email}">${centre.email}</a><br>
                    ${centre.phone}<br>
                    <a href="${centre.website}" target="_blank">${centre.website}</a><br>
                    Distance: ${centre.distance.toFixed(2)} km
                `;
                resultsDiv.appendChild(centreDiv);
            });
        }

        function showAdminPopup() {
            document.getElementById('admin-popup').style.display = 'block';
        }

        function closeAdminPopup() {
            document.getElementById('admin-popup').style.display = 'none';
        }

        function checkPassword() {
            const password = document.getElementById('admin-password').value;
            if (password === '1770') {
                document.getElementById('admin-popup').style.display = 'none';
                document.getElementById('admin-form').style.display = 'block';
                showAddCentreSection();
            } else {
                alert('Incorrect password.');
            }
        }

        function showAddCentreSection() {
            document.getElementById('add-centre-section').style.display = 'block';
            document.getElementById('edit-delete-section').style.display = 'none';
        }

        function showEditDeleteSection() {
            document.getElementById('add-centre-section').style.display = 'none';
            document.getElementById('edit-delete-section').style.display = 'block';
            displayEditDeleteList();
        }

        function addOrModifyCentre() {
            const postcode = document.getElementById('postcode').value;
            fetch(`https://api.postcodes.io/postcodes/${encodeURIComponent(postcode)}`)
                .then(response => response.json())
                .then(data => {
                    if (data.status !== 200 || !data.result) {
                        alert('Invalid postcode. Please try again.');
                        return;
                    }
                    const centre = {
                        centre: document.getElementById('centre-name').value,
                        rabbi: document.getElementById('rabbi-name').value,
                        phone: document.getElementById('phone').value,
                        email: document.getElementById('email').value,
                        address: document.getElementById('address').value,
                        postcode: postcode,
                        coordinates: {
                            lat: data.result.latitude,
                            lng: data.result.longitude
                        },
                        website: document.getElementById('website').value
                    };
                    chabadCentres.push(centre);
                    addMarkers();
                    alert('Chabad centre added successfully.');
                })
                .catch(error => {
                    console.error('Error fetching postcode data:', error);
                    alert('There was an error with the postcode lookup. Please try again.');
                });
        }

        function displayEditDeleteList() {
            const centresList = document.getElementById('centres-list');
            centresList.innerHTML = '';
            chabadCentres.forEach((centre, index) => {
                const centreDiv = document.createElement('div');
                centreDiv.className = 'admin-centre';
                centreDiv.innerHTML = `
                    <span>${centre.centre}</span>
                    <div>
                        <button onclick="editCentre(${index})">Edit</button>
                        <button onclick="deleteCentre(${index})">Delete</button>
                    </div>
                `;
                centresList.appendChild(centreDiv);
            });
        }

        function editCentre(index) {
            const centre = chabadCentres[index];
            document.getElementById('centre-name').value = centre.centre;
            document.getElementById('rabbi-name').value = centre.rabbi;
            document.getElementById('phone').value = centre.phone;
            document.getElementById('email').value = centre.email;
            document.getElementById('address').value = centre.address;
            document.getElementById('postcode').value = centre.postcode;
            document.getElementById('website').value = centre.website;
            showAddCentreSection();
            chabadCentres.splice(index, 1);
        }

        function deleteCentre(index) {
            chabadCentres.splice(index, 1);
            displayEditDeleteList();
            addMarkers();
        }

        function uploadCentres(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        if (Array.isArray(data)) {
                            chabadCentres = chabadCentres.concat(data);
                            addMarkers();
                            alert('Centres uploaded successfully.');
                        } else {
                            alert('Invalid file format. Please upload a JSON array.');
                        }
                    } catch (error) {
                        alert('Error reading file. Please ensure it is a valid JSON or CSV file.');
                    }
                };
                reader.readAsText(file);
            }
        }

        function addUploadedCentres() {
            addMarkers();
            alert('Uploaded centres added successfully.');
        }
    </script>
</body>
</html>
